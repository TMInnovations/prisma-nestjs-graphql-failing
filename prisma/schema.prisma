datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

generator nestjsgraphql {
  provider                              = "node node_modules/prisma-nestjs-graphql"
  fields_Validator_from                 = "class-validator"
  fields_Validator_input                = true
  requireSingleFieldsInWhereUniqueInput = true
  emitSingle                            = true
  emitCompiled                          = true
  purgeOutput                           = true
  output                                = "../node_modules/@prisma/client/nestjs-graphql"
}

// Temporal

model Event {
  id String @id @default(cuid())

  when DateTime @default(now())
  what String
  from Json?
  to   Json?


  // RELATIONS

  who     User   @relation(fields: [id_user], references: [id])
  id_user String


  // INVERSE RELATIONS

  history_created_history History? @relation("history_created")

  updated    History? @relation("history_updated", fields: [id_history], references: [id])
  id_history String?

  history_deleted_history History? @relation("history_deleted")
}

model History {
  id String @id @default(cuid())


  // RELATIONS

  created    Event   @relation(name: "history_created", fields: [id_created], references: [id])
  id_created String  @unique
  updated    Event[] @relation("history_updated")
  deleted    Event?  @relation(name: "history_deleted", fields: [id_deleted], references: [id])
  id_deleted String? @unique


  // INVERSE RELATIONS

  user_history_user User? @relation("user_history")
}

// Auth

model User {
  id String @id @default(cuid())


  // RELATIONS

  history    History? @relation(name: "user_history", fields: [id_history], references: [id])
  id_history String?  @unique


  profile Profile?


  // BI-DIRECTIONAL RELATIONS



  // INVERSE RELATIONS

  event_who_event Event[]
}

// Business Logic

model Profile {
  id         String    @id @default(cuid())
  first_name String?
  last_name  String?
  birthday   DateTime?
  svnr       String?


  // RELATIONS

  address    Address? @relation(fields: [id_address], references: [id])
  id_address String?  @unique


  // BI-DIRECTIONAL RELATIONS

  workers Worker[]

  customer Customer?


  // INVERSE RELATIONS

  user    User?   @relation(fields: [id_user], references: [id])
  id_user String? @unique

  collector_profile_customer Customer? @relation(name: "collector", fields: [customer_numbner], references: [number])
  customer_numbner           String?
}

model Address {
  id       String  @id @default(cuid())
  line1    String?
  line2    String?
  city     String?
  province String?
  zip      String?


  // RELATIONS

  id_country String

  telephone Telephone[]


  // INVERSE RELATIONS

  profile Profile?

  destination Destination?
}

model Telephone {
  id               String @id @default(cuid())
  telephone_number String


  // INVERSE RELATIONS

  address    Address? @relation(fields: [id_address], references: [id])
  id_address String?

}

model Customer {
  number String @id


  // RELATIONS

  destinations Destination[]

  collectors Profile[] @relation(name: "collector")

  favoriteDelivery    Delivery @relation(fields: [id_favoriteDelivery], references: [id])
  id_favoriteDelivery String   @unique


  // BI-DIRECTIONAL RELATIONS

  profile    Profile @relation(fields: [id_profile], references: [id])
  id_profile String  @unique

  Parcel Parcel[]
}

model Destination {
  id    String @id @default(cuid())
  name  String
  email String


  // RELATIONS

  address    Address? @relation(fields: [id_address], references: [id])
  id_address String?  @unique


  // INVERSE RELATIONS

  customer_destination_customer Customer? @relation(fields: [customer_number], references: [number])
  customer_number               String?

  delivery_destination_delivery Delivery?
}

model Delivery {
  id String @id @default(cuid())


  // RELATIONS

  destination    Destination? @relation(fields: [id_destination], references: [id])
  id_destination String?      @unique


  // INVERSE RELATIONS

  customer_favouriteDelivery_customer Customer?
  Parcel                              Parcel[]
}

model Parcel {
  id String @id @default(cuid())

  l Float?
  b Float?
  h Float?

  mass Float?


  // RELATIONS

  delivery    Delivery? @relation(fields: [id_delivery], references: [id])
  id_delivery String?

  customer        Customer? @relation(fields: [customer_number], references: [number])
  customer_number String?



  // INVERSE RELATIONS


}

// Worker

model Worker {
  personnel_number String  @id
  activated        Boolean @default(true)


  // RELATIONS



  // INVERSE RELATIONS

  profile    Profile @relation(fields: [id_profile], references: [id])
  id_profile String
}

// Customer
