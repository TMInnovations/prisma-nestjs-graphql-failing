datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

generator nestjsgraphql {
  provider                              = "node node_modules/prisma-nestjs-graphql"
  fields_Validator_from                 = "class-validator"
  fields_Validator_input                = true
  requireSingleFieldsInWhereUniqueInput = true
  emitSingle                            = true
  emitCompiled                          = true
  purgeOutput                           = true
  output                                = "../node_modules/@prisma/client/nestjs-graphql"
}

// Temporal

model Event {
  id String @id @default(cuid())

  when DateTime @default(now())
  what String
  from Json?
  to   Json?


  // RELATIONS

  who     User   @relation(fields: [id_user], references: [id])
  id_user String


  // INVERSE RELATIONS

  history_created_history History? @relation("history_created")

  updated    History? @relation("history_updated", fields: [id_history], references: [id])
  id_history String?

  history_deleted_history History? @relation("history_deleted")
}

model History {
  id String @id @default(cuid())


  // RELATIONS

  created    Event   @relation(name: "history_created", fields: [id_created], references: [id])
  id_created String  @unique
  updated    Event[] @relation("history_updated")
  deleted    Event?  @relation(name: "history_deleted", fields: [id_deleted], references: [id])
  id_deleted String? @unique


  // INVERSE RELATIONS

  user_history_user User? @relation("user_history")
}

// Auth

model User {
  id String @id @default(cuid())


  // RELATIONS

  history    History? @relation(name: "user_history", fields: [id_history], references: [id])
  id_history String?  @unique


  profile Profile?


  // BI-DIRECTIONAL RELATIONS



  // INVERSE RELATIONS

  event_who_event Event[]
}

// Business Logic

model Profile {
  id         String    @id @default(cuid())
  first_name String?
  last_name  String?
  birthday   DateTime?
  svnr       String?


  // RELATIONS

  address    Address? @relation(fields: [id_address], references: [id])
  id_address String?  @unique


  // BI-DIRECTIONAL RELATIONS

  workers Worker[]

  customer Customer?


  // INVERSE RELATIONS

  user    User?   @relation(fields: [id_user], references: [id])
  id_user String? @unique

  collector_profile_customer Customer? @relation(name: "collector", fields: [customer_numbner], references: [number])
  customer_numbner           String?
}

model Address {
  id       String  @id @default(cuid())
  line1    String?
  line2    String?
  city     String?
  province String?
  zip      String?


  // RELATIONS

  country    Country @relation(fields: [id_country], references: [id])
  id_country String

  telephone Telephone[]


  // INVERSE RELATIONS

  profile Profile?

  destination Destination?

  branch Branch?
}

model Country {
  id     String @id @default(cuid())
  name   String @unique
  number Int    @unique


  // INVERSE RELATIONS

  address  Address[]
  customer Customer[]
}

model Telephone {
  id               String         @id @default(cuid())
  telephone_number String
  availability     Availability[]
  contact_type     ContactType


  // INVERSE RELATIONS

  address    Address? @relation(fields: [id_address], references: [id])
  id_address String?

}

enum Availability {
  DAY
  MORNING
  EVENING
  NIGHT
}

enum ContactType {
  MOBILE
  HOME
  WORK
}

model Customer {
  number String @id

  type CustomerType


  // RELATIONS

  country    Country @relation(fields: [id_country], references: [id])
  id_country String

  destinations Destination[]

  collectors Profile[] @relation(name: "collector")

  favoriteDelivery    Delivery @relation(fields: [id_favoriteDelivery], references: [id])
  id_favoriteDelivery String   @unique


  // BI-DIRECTIONAL RELATIONS

  profile    Profile @relation(fields: [id_profile], references: [id])
  id_profile String  @unique

  Parcel Parcel[]
}

enum CustomerType {
  PRIVATE
  BUSINESS
}

model Destination {
  id    String @id @default(cuid())
  name  String
  email String


  // RELATIONS

  address    Address? @relation(fields: [id_address], references: [id])
  id_address String?  @unique


  // INVERSE RELATIONS

  customer_destination_customer Customer? @relation(fields: [customer_number], references: [number])
  customer_number               String?

  delivery_destination_delivery Delivery?
}

model Company {
  id   String @id @default(cuid())
  name String
  uid  String


  // RELATIONS
  branches Branch[]
}

model Branch {
  id   String @id @default(cuid())
  name String

  // RELATIONS

  address    Address @relation(fields: [id_address], references: [id])
  id_address String  @unique

  // INVERSE RELATIONS

  company    Company @relation(fields: [id_company], references: [id])
  id_company String

  delivery_branch_deliveries Delivery[]

}

enum DeliveryStrategy {
  SHIP
  COLLECT
}

model Delivery {
  id       String           @id @default(cuid())
  strategy DeliveryStrategy


  // RELATIONS

  branch    Branch? @relation(fields: [id_branch], references: [id])
  id_branch String?

  destination    Destination? @relation(fields: [id_destination], references: [id])
  id_destination String?      @unique


  // INVERSE RELATIONS

  customer_favouriteDelivery_customer Customer?
  Parcel                              Parcel[]
}

model Parcel {
  id String @id @default(cuid())

  l Float?
  b Float?
  h Float?

  mass Float?


  // RELATIONS

  labels Dalabel[]

  delivery    Delivery? @relation(fields: [id_delivery], references: [id])
  id_delivery String?

  customer        Customer? @relation(fields: [customer_number], references: [number])
  customer_number String?

  surcharges Surcharge[]


  // INVERSE RELATIONS

  scans Scan[]

}

model Dalabel {
  id String @id @default(cuid())

  data String

  active Boolean @default(true)


  // INVERSE RELATION

  parcel    Parcel @relation(fields: [id_parcel], references: [id])
  id_parcel String

  scan_dalabel_scans Scan[]
}

model Scan {
  id String @id @default(cuid())

  type ScanType

  data String


  // RELATIONS

  //machine Machine?

  dalabel    Dalabel? @relation(fields: [id_dalabel], references: [id])
  id_dalabel String?


  // INVERSE RELATIONS

  parcel    Parcel? @relation(fields: [id_parcel], references: [id])
  id_parcel String?
}

enum ScanType {
  DALABEL
  UPS
  DHL
  GLS
  POST_AT
  UNDEFINED
}

model Surcharge {
  id String @id @default(cuid())

  price Float


  // RELATIONS

  type             Surchargetype @relation(fields: [id_surchargetype], references: [id])
  id_surchargetype String


  // INVERSE RELATIONS

  parcel_surcharge_parcel Parcel @relation(fields: [id_parcel], references: [id])
  id_parcel               String
}

model Surchargetype {
  id String @id @default(cuid())

  name String

  standard_price Float


  // INVERSE RELATIONS

  surcharge_surchargeType_surcharges Surcharge[]
}

// Worker

enum WorkerType {
  INTERNAL
  EXTERNAL
}

model Worker {
  personnel_number String  @id
  activated        Boolean @default(true)


  // RELATIONS

  type WorkerType



  // INVERSE RELATIONS

  profile    Profile @relation(fields: [id_profile], references: [id])
  id_profile String
}

// Customer
